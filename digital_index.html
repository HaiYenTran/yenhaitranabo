<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bí Quyết Giảm Cân Lành Mạnh – Sống Khỏe Mỗi Ngày</title>
  <link rel="icon" href="assets/favicon.ico" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <style>
    /* (--- keep your existing CSS unchanged ---) */
  </style>
</head>
<body>
  <!-- (--- keep your existing HTML content unchanged ---) -->

  <script>
    // Helpers
    function setCookie(name,val,days){
      let d=new Date(); d.setTime(d.getTime()+days*864e5);
      document.cookie=`${name}=${encodeURIComponent(val)};expires=${d.toUTCString()};path=/`;
    }
    function getCookie(name){
      return document.cookie.split('; ').reduce((r,c)=>{
        let [k,v]=c.split('='); return k===name?decodeURIComponent(v):r;
      },'');
    }

    const overlay   = document.getElementById('authOverlay');
    const mainWrap  = document.querySelector('.main-wrap');
    const banner    = document.getElementById('passwordBanner');
    const errMsg    = document.getElementById('authError');
    const btn       = document.getElementById('authBtn');
    const methods   = document.getElementsByName('method');
    const grpPwd    = document.getElementById('group-password');
    const grpEmail  = document.getElementById('group-email');
    const grpPhone  = document.getElementById('group-phone');

    // === GAS_URL: paste your Apps Script Web App URL here ===
    const GAS_URL = 'REPLACE_WITH_YOUR_WEB_APP_URL';

    // Switch inputs on method change
    Array.from(methods).forEach(r=>{
      r.addEventListener('change',()=>{
        grpPwd.classList.toggle('active', r.value==='password');
        grpEmail.classList.toggle('active', r.value==='email');
        grpPhone.classList.toggle('active', r.value==='phone');
        errMsg.style.display='none';
      });
    });

    // On load: if cookie present, show content
    window.addEventListener('DOMContentLoaded', ()=>{
      if(getCookie('access_granted')==='1'){
        banner.style.display='block';
        overlay.style.display='none';
        mainWrap.style.display='block';
      }
    });

    // Handle authentication
    btn.addEventListener('click', async ()=>{
      errMsg.style.display='none';
      let method = Array.from(methods).find(r=>r.checked).value;
      if(method==='password'){
        let pwd = document.getElementById('inp-password').value.trim();
        if(pwd==='toiyeusongxanh'){
          overlay.style.display='none';
          mainWrap.style.display='block';
        } else {
          errMsg.textContent='Mật khẩu không đúng.'; errMsg.style.display='block';
        }
      } else {
        let val = method==='email'
          ? document.getElementById('inp-email').value.trim()
          : document.getElementById('inp-phone').value.trim();
        let reEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        let rePhone = /^\d{9,15}$/;
        if((method==='email'&&reEmail.test(val))||(method==='phone'&&rePhone.test(val))){
          // === Send to Google Apps Script Web App ===
          try {
            const fd = new FormData();
            fd.append('contact', val);
            fd.append('method', method);
            fd.append('page', location.pathname);
            // Apps Script doesn't include CORS headers by default → use no-cors
            await fetch(GAS_URL, { method:'POST', mode:'no-cors', body: fd });
          } catch (e) {
            console.warn('Submit to GAS failed (ignored):', e);
          }

          // Grant access regardless of response visibility in no-cors mode
          setCookie('access_granted','1',30);
          overlay.style.display='none';
          mainWrap.style.display='block';
          banner.style.display='block';
        } else {
          errMsg.textContent='Vui lòng nhập đúng định dạng.'; errMsg.style.display='block';
        }
      }
    });
  </script>
</body>
</html>